<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.2.0" />
<meta name="description" content="This page describes the interactive mode of the yash shell." />
<title>Interactive mode</title>
<link rel="stylesheet" href="./asciidoc.css" type="text/css" />


</head>
<body class="article">
<div id="header">
<h1>Interactive mode</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>The <dfn>interactive mode</dfn> is a mode of the shell intended for direct
interaction with a user.
If yash is in the interactive mode, it is called an <dfn>interactive shell</dfn>.</p></div>
<div class="paragraph"><p>Whether a shell runs in the interactive mode or not is determined in the
<a href="invoke.html">invocation of the shell</a>.
After the shell has started up, the interactive mode cannot be switched on or
off.</p></div>
<div class="paragraph"><p>When the shell is interactive:</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="invoke.html#init">Initialization</a> scripts are executed during
  invocation.
</p>
</li>
<li>
<p>
The shell <a href="interact.html#mailcheck">checks for mail</a> and prints a command
  <a href="#prompt">prompt</a> when it reads a command.
  Job status changes are also reported if <a href="job.html">job control</a> is
  active.
  <a href="lineedit.html">Line-editing</a> may be used depending on the capability of
  the terminal.
</p>
</li>
<li>
<p>
Commands executed are automatically registered in command
  <a href="#history">history</a>.
</p>
</li>
<li>
<p>
If a command executed by the shell is killed by a signal other than SIGINT
  and SIGPIPE, the shell reports the fact to the standard error.
</p>
</li>
<li>
<p>
The filename token is subject to <a href="expand.html#glob">pathname expansion</a>
  in <a href="redir.html#file">file redirection</a>.
</p>
</li>
<li>
<p>
The shell does not exit when it encounters a syntax or expansion error
  during command execution. (cf. <a href="exec.html#exit">Termination of the
  shell</a>)
</p>
</li>
<li>
<p>
The shell does not exit when it receives the SIGINT, SIGTERM, or SIGQUIT
  signal.
</p>
</li>
<li>
<p>
A signal handler can be changed by the <a href="_trap.html">trap built-in</a>
  even if the handler had been set to &#8220;ignore&#8221; when the shell was invoked.
</p>
</li>
<li>
<p>
The value of the <a href="params.html#sp-hyphen"><code>-</code> special parameter</a> contains
  <code>i</code>.
</p>
</li>
<li>
<p>
The shell&#8217;s locale reflects the value of the
  <a href="params.html#sv-lc_ctype"><code>LC_CTYPE</code> variable</a> whenever the value is
  changed (if the shell is not in the <a href="posix.html">POSIXly-correct mode</a>).
</p>
</li>
<li>
<p>
Commands are executed even when the <a href="_set.html#so-exec">exec option</a> is
  off.
</p>
</li>
<li>
<p>
The <a href="_set.html#so-ignoreeof">ignore-eof option</a> takes effect when
  enabled.
</p>
</li>
<li>
<p>
When the shell reaches the end of input or the <a href="_exit.html">exit
  built-in</a> is executed, the shell checks if there is any stopped
  <a href="job.html">job</a>.
  If so, the shell prints a warning and does not actually exit.
</p>
</li>
<li>
<p>
The <a href="_suspend.html">suspend built-in</a> by default cannot stop the shell
  if it is a session leader.
</p>
</li>
<li>
<p>
The shell does not exit when the <a href="_dot.html">dot built-in</a> fails to find
  a script file to read.
</p>
</li>
<li>
<p>
The shell does not exit when the <a href="_exec.html">exec built-in</a> fails to
  execute a command (if not in the <a href="posix.html">POSIXly-correct mode</a>).
</p>
</li>
<li>
<p>
When a job finished for which the <a href="_wait.html">wait built-in</a> has been
  waiting, the fact is reported (only if <a href="job.html">job control</a> is active
  and not in the <a href="posix.html">POSIXly-correct mode</a>).
</p>
</li>
<li>
<p>
A prompt is printed when the <a href="_read.html">read built-in</a> reads a second
  or following line.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="prompt">Prompts</h2>
<div class="sectionbody">
<div class="paragraph"><p>The interactive shell prints a <dfn>prompt</dfn> just before it reads a command.
The contents of the prompt is specified by the value of the
<a href="params.html#sv-ps1"><code>PS1</code></a> and <a href="params.html#sv-ps2"><code>PS2</code></a> variables.
The former is used for reading the first line of the command and the latter
for other lines.</p></div>
<div class="paragraph"><p>When the prompt is printed, the variable value is subjected to
<a href="expand.html#params">parameter expansion</a>, <a href="expand.html#cmdsub">command
substitution</a>, and <a href="expand.html#arith">arithmetic expansion</a>
(but note that the POSIX standard requires parameter expansion only).
The result of the expansion is parsed by the rules below to make the actual
prompt string, which is printed to the standard error.</p></div>
<div class="paragraph"><p>In the <a href="posix.html">POSIXly-correct mode</a>, each exclamation mark (<code>!</code>) in
the string is substituted with the command <a href="#history">history</a> number of the
command that is being input.
Two adjacent exclamation marks (<code>!!</code>) are printed as a single exclamation.
Other characters are printed intact.</p></div>
<div class="paragraph"><p>If the shell is not in the POSIXly-command mode, the following notations can
be used to format the prompt string.
Notations are replaced with the strings designated in the list below.
Characters that are not interpreted as notations are printed intact.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>\a</code>
</dt>
<dd>
<p>
Bell character (ASCII code: 7)
</p>
</dd>
<dt class="hdlist1">
<code>\e</code>
</dt>
<dd>
<p>
Escape character (ASCII code: 27)
</p>
</dd>
<dt class="hdlist1">
<code>\j</code>
</dt>
<dd>
<p>
The number of <a href="job.html">jobs</a> in the shell.
</p>
</dd>
<dt class="hdlist1">
<code>\n</code>
</dt>
<dd>
<p>
Newline character (ASCII code: 10)
</p>
</dd>
<dt class="hdlist1">
<code>\r</code>
</dt>
<dd>
<p>
Carriage return character (ASCII code: 13)
</p>
</dd>
<dt class="hdlist1">
<code>\!</code>
</dt>
<dd>
<p>
The command <a href="#history">history</a> number of the command that is being input
</p>
</dd>
<dt class="hdlist1">
<code>\$</code>
</dt>
<dd>
<p>
<code>#</code> if the shell&#8217;s effective user ID is 0; <code>$</code> otherwise.
</p>
</dd>
<dt class="hdlist1">
<code>\\</code>
</dt>
<dd>
<p>
Backslash
</p>
</dd>
<dt class="hdlist1">
<code>\[</code>
</dt>
<dt class="hdlist1">
<code>\]</code>
</dt>
<dd>
<p>
These two notations can surround part of the prompt string that is not visible
on the terminal.
The surrounded part is ignored when the shell counts the number of characters
that is displayed on the terminal, thus making characters correctly aligned on
the terminal when the prompt string contains special invisible characters.
</p>
</dd>
<dt class="hdlist1">
<code>\f<var>fontspecs</var>.</code>
</dt>
<dd>
<p>
When <a href="lineedit.html">line-editing</a> is active, this notation is replaced
with special characters to change font styles on the terminal
if the terminal is capable of it.
If line-editing is inactive or the terminal is incapable of changing font
styles, this notation is silently ignored.
One or more of the following can be used for <var>fontspecs</var>:
</p>
<div class="openblock">
<div class="content">
<div class="dlist"><dl>
<dt class="hdlist1">
<code>k</code>
</dt>
<dd>
<p>
Change font color to black
</p>
</dd>
<dt class="hdlist1">
<code>r</code>
</dt>
<dd>
<p>
Change font color to red
</p>
</dd>
<dt class="hdlist1">
<code>g</code>
</dt>
<dd>
<p>
Change font color to green
</p>
</dd>
<dt class="hdlist1">
<code>y</code>
</dt>
<dd>
<p>
Change font color to yellow
</p>
</dd>
<dt class="hdlist1">
<code>b</code>
</dt>
<dd>
<p>
Change font color to blue
</p>
</dd>
<dt class="hdlist1">
<code>m</code>
</dt>
<dd>
<p>
Change font color to magenta
</p>
</dd>
<dt class="hdlist1">
<code>c</code>
</dt>
<dd>
<p>
Change font color to cyan
</p>
</dd>
<dt class="hdlist1">
<code>w</code>
</dt>
<dd>
<p>
Change font color to white
</p>
</dd>
<dt class="hdlist1">
<code>K</code>
</dt>
<dd>
<p>
Change background color to black
</p>
</dd>
<dt class="hdlist1">
<code>R</code>
</dt>
<dd>
<p>
Change background color to red
</p>
</dd>
<dt class="hdlist1">
<code>G</code>
</dt>
<dd>
<p>
Change background color to green
</p>
</dd>
<dt class="hdlist1">
<code>Y</code>
</dt>
<dd>
<p>
Change background color to yellow
</p>
</dd>
<dt class="hdlist1">
<code>B</code>
</dt>
<dd>
<p>
Change background color to blue
</p>
</dd>
<dt class="hdlist1">
<code>M</code>
</dt>
<dd>
<p>
Change background color to magenta
</p>
</dd>
<dt class="hdlist1">
<code>C</code>
</dt>
<dd>
<p>
Change background color to cyan
</p>
</dd>
<dt class="hdlist1">
<code>W</code>
</dt>
<dd>
<p>
Change background color to white
</p>
</dd>
<dt class="hdlist1">
<code>t</code>
</dt>
<dd>
<p>
Make font color or background brighter
(can only be used just after one of the characters above)
</p>
</dd>
<dt class="hdlist1">
<code>d</code>
</dt>
<dd>
<p>
Change font and background colors to normal
</p>
</dd>
<dt class="hdlist1">
<code>s</code>
</dt>
<dd>
<p>
Make font standout
</p>
</dd>
<dt class="hdlist1">
<code>u</code>
</dt>
<dd>
<p>
Make font underlined
</p>
</dd>
<dt class="hdlist1">
<code>v</code>
</dt>
<dd>
<p>
Make font and background colors reversed
</p>
</dd>
<dt class="hdlist1">
<code>b</code>
</dt>
<dd>
<p>
Make font blink
</p>
</dd>
<dt class="hdlist1">
<code>i</code>
</dt>
<dd>
<p>
Make font dim
</p>
</dd>
<dt class="hdlist1">
<code>o</code>
</dt>
<dd>
<p>
Make font bold
</p>
</dd>
<dt class="hdlist1">
<code>x</code>
</dt>
<dd>
<p>
Make font invisible
</p>
</dd>
<dt class="hdlist1">
<code>D</code>
</dt>
<dd>
<p>
Make color and style normal
</p>
</dd>
</dl></div>
</div></div>
<div class="paragraph"><p>The actual colors of font and background are defined by the terminal.
Different terminals may use different colors.</p></div>
</dd>
</dl></div>
<div class="paragraph"><p>In addition to the normal prompt, a prompt string can be displayed to the
right of the cursor if <a href="lineedit.html">line-editing</a> is active.
Those prompts are called <dfn>right prompts</dfn>.
The contents of right prompts are defined by the value of the
<a href="params.html#sv-ps1r"><code>PS1R</code></a> and <a href="params.html#sv-ps2r"><code>PS2R</code></a>
variables, each corresponding to the
<a href="params.html#sv-ps1"><code>PS1</code></a> and <a href="params.html#sv-ps2"><code>PS2</code></a> variables.</p></div>
<div class="paragraph"><p>Using the above-said notations, the font style of command strings the user
inputs can be changed as well as that of prompts.
The font style of command strings is defined by the value of the
<a href="params.html#sv-ps1s"><code>PS1S</code></a> and <a href="params.html#sv-ps2s"><code>PS2S</code></a>
variables, each corresponding to the
<a href="params.html#sv-ps1"><code>PS1</code></a> and <a href="params.html#sv-ps2"><code>PS2</code></a> variables.
The value can contain the <code>\f<var>fontspecs</var>.</code> notation only.
If you enable <a href="lineedit.html#prediction">command line prediction</a>, the
predicted part of the command line can also be styled with the
<a href="params.html#sv-ps1p"><code>PS1P</code></a> and <a href="params.html#sv-ps2p"><code>PS2P</code></a>
variables.</p></div>
<div class="paragraph"><p>When the shell is not in the <a href="posix.html">POSIXly-correct mode</a>, the prompt
variables can be defined with a name prefixed with <code>YASH_</code> (e.g.
<a href="params.html#sv-yash_ps1"><code>YASH_PS1</code></a>). This allows using a different
prompt string than that in the POSIXly-correct mode.</p></div>
<div class="paragraph"><p>When the shell is not in the <a href="posix.html">POSIXly-correct mode</a>:</p></div>
<div class="ulist"><ul>
<li>
<p>
The value of the <a href="params.html#sv-prompt_command"><code>PROMPT_COMMAND</code> variable</a>
  is executed before each prompt.
</p>
</li>
<li>
<p>
The value of the
  <a href="params.html#sv-post_prompt_command"><code>POST_PROMPT_COMMAND</code> variable</a> is
  executed after each line is input. While the execution, the
  <a href="params.html#sv-command"><code>COMMAND</code> variable</a> is set to the just input
  line. You can even modify the variable to manipulate the command to be
  executed. If you unset the variable, the command will not be executed.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="history">Command history</h2>
<div class="sectionbody">
<div class="paragraph"><p><dfn>Command history</dfn> is a feature of the shell that remembers executed
commands to allow re-executing them later.
Commands executed in the interactive mode are automatically saved in the
command history.
Saved commands can be edited and re-executed using
<a href="lineedit.html">line-editing</a> and the <a href="_fc.html">fc</a> and
<a href="_history.html">history</a> built-ins.</p></div>
<div class="paragraph"><p>Commands are saved line by line.
Lines that do not contain any non-whitespace characters are not saved in the
history.
Lines that start with whitespaces are not saved
when the <a href="_set.html#so-histspace">hist-space option</a> is on.</p></div>
<div class="paragraph"><p>Command history is saved in a file.
When history is first used after an interactive shell was started,
the shell opens a file to save history in.
The filename is specified by the value of the
<a href="params.html#sv-histfile"><code>HISTFILE</code> variable</a>.
If the file contains history data when opened, the data is restored to the
shell&#8217;s history.
The file contents are updated in real time as the user inputs commands into
the shell.
If the <code>HISTFILE</code> variable is not set or the file cannot be opened
successfully, history is not saved in the file, but the history feature will
be functional in all other respects.</p></div>
<div class="paragraph"><p>The number of commands saved in history is specified by the value of the
<a href="params.html#sv-histsize"><code>HISTSIZE</code> variable</a>.
The shell automatically removes old history data so that the number of saved
commands does not exceed the value.
If the <code>HISTSIZE</code> variable is not set or its value is not a natural number,
500 items will be saved in history.</p></div>
<div class="paragraph"><p>The shell looks at the value of the <code>HISTFILE</code> and <code>HISTSIZE</code> variables only
when the history feature is first used after the shell was started.
&#8220;The history feature is used&#8221; when:</p></div>
<div class="ulist"><ul>
<li>
<p>
the <a href="_fc.html">fc</a> or <a href="_history.html">history</a> built-in is executed,
</p>
</li>
<li>
<p>
<a href="lineedit.html">line-editing</a> is used (regardless of whether or not
  history data is recalled in line-editing), or
</p>
</li>
<li>
<p>
a command is input to the shell
</p>
</li>
</ul></div>
<div class="paragraph"><p>Therefore, the variables should be set in
<a href="invoke.html#init">initialization</a> scripts.</p></div>
<div class="paragraph"><p>When more than one instance of yash shares a single history file, all the
shells use the same history data.
As a result, commands that have been executed by a shell instance can be
recalled on another shell instance.
Shells sharing the same history should have the same <code>HISTSIZE</code> value so that
they manipulate history data properly.</p></div>
<div class="paragraph"><p>Yash&#8217;s history data file has its own format that is incompatible with other
kinds of shells.</p></div>
<div class="paragraph"><p>The <a href="params.html#sv-histrmdup"><code>HISTRMDUP</code> variable</a> can be set to remove
duplicate history items.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="mailcheck">Mail checking</h2>
<div class="sectionbody">
<div class="paragraph"><p>An interactive shell can notify receipt of email.
The shell periodically checks the modification date/time of a file specified
by the user.
If the file has been modified since the previous check, the shell prints a
notification message (except when the shell is not in the
<a href="posix.html">POSIXly-correct mode</a> and the file is empty).
By specifying a mailbox file to be checked, the shell will print a message
when the file has been modified, that is, some mail has been received.</p></div>
<div class="paragraph"><p>Check is done just before the shell prints a command line prompt.
The interval of checks can be specified by the
<a href="params.html#sv-mailcheck"><code>MAILCHECK</code> variable</a> in seconds.
If the variable value is 0, check is done before every prompt.
If the variable value is not a non-negative integer, no checks are done.</p></div>
<div class="paragraph"><p>The file whose modification time is checked is specified by the
<a href="params.html#sv-mail"><code>MAIL</code> variable</a>.
The variable value should be set to the pathname of the file.</p></div>
<div class="paragraph"><p>If you want to check more than one file or customize the notification message,
you can set the <a href="params.html#sv-mailpath"><code>MAILPATH</code> variable</a> instead of
the <code>MAIL</code> variable.
When the <code>MAILPATH</code> variable is set, the <code>MAIL</code> variable is ignored.
The value of the <code>MAILPATH</code> variable should be set to one or more
colon-separated pathnames of files to be checked.
Each pathname can be followed by a percent sign (<code>%</code>) and a custom
notification message, which is printed when the corresponding file has been
modified.
If the pathname contains a percent sign, it should be
<a href="syntax.html#quotes">quoted</a> by a backslash.
The specified message is subject to <a href="expand.html#params">parameter
expansion</a>.
For example, if the value of the <code>MAILPATH</code> variable is
<code>/foo/mail%New mail!:/bar/mailbox%You've got mail:/baz/mail\%data</code>,
the shell will print</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>New mail!</code> when the file /foo/mail has been modified
</p>
</li>
<li>
<p>
<code>You've got mail</code> when the file /bar/mailbox has been modified
</p>
</li>
<li>
<p>
the default message when the file /baz/mail%data has been modified.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated
 2024-04-20 22:53:39 JST
</div>
</div>
</body>
</html>
